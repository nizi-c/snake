import router from '@ohos.router';
import { ThemeManager, LightTheme, DarkTheme, Theme } from '../models/ThemeManager';

@Entry
@Component
struct ThemeSettingsPage {
  @State currentTheme: Theme = LightTheme;
  private themeManager: ThemeManager = ThemeManager.getInstance();

  async aboutToAppear() {
    await this.themeManager.loadTheme(getContext(this));
    this.currentTheme = this.themeManager.getTheme();
    
    // ç›‘å¬ä¸»é¢˜å˜åŒ–
    this.themeManager.addListener((theme: Theme) => {
      this.currentTheme = theme;
    });
  }

  aboutToDisappear() {
    // æ¸…ç†ç›‘å¬å™¨
    this.themeManager.removeListener((theme: Theme) => {
      this.currentTheme = theme;
    });
  }

  async switchTheme(themeName: string) {
    await this.themeManager.saveTheme(getContext(this), themeName);
    this.currentTheme = this.themeManager.getTheme();
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Button('è¿”å›')
          .fontSize(16)
          .backgroundColor(this.currentTheme.buttonSecondary)
          .fontColor(this.currentTheme.primaryText)
          .onClick(() => {
            router.back();
          })

        Text('è®¾ç½®')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor(this.currentTheme.primaryText)

        // å ä½ä¿æŒå±…ä¸­
        Text('')
          .width(60)
      }
      .width('100%')
      .height(60)
      .justifyContent(FlexAlign.SpaceBetween)
      .padding({ left: 20, right: 20 })
      .backgroundColor(this.currentTheme.secondaryBg)

      // è®¾ç½®åˆ—è¡¨
      Scroll() {
        Column() {
          // ä¸»é¢˜è®¾ç½®åˆ†ç»„
          Column() {
            Text('ä¸»é¢˜è®¾ç½®')
              .fontSize(16)
              .fontWeight(FontWeight.Bold)
              .fontColor(this.currentTheme.secondaryText)
              .width('100%')
              .padding({ left: 20, top: 20, bottom: 10 })

            // æµ…è‰²ä¸»é¢˜é€‰é¡¹
            Row() {
              Text('â˜€ï¸')
                .fontSize(32)
                .margin({ right: 15 })

              Column() {
                Text('æµ…è‰²ä¸»é¢˜')
                  .fontSize(18)
                  .fontWeight(FontWeight.Medium)
                  .fontColor(this.currentTheme.primaryText)
                  .margin({ bottom: 4 })

                Text('æ˜åªšæ¸©æš–æŸ”å’Œ')
                  .fontSize(14)
                  .fontColor(this.currentTheme.secondaryText)
              }
              .alignItems(HorizontalAlign.Start)
              .layoutWeight(1)

              if (this.currentTheme.name === 'light') {
                Text('âœ“')
                  .fontSize(24)
                  .fontColor(this.currentTheme.successColor)
                  .fontWeight(FontWeight.Bold)
              }
            }
            .width('100%')
            .padding({ left: 20, right: 20, top: 15, bottom: 15 })
            .backgroundColor(this.currentTheme.cardBg)
            .borderRadius(12)
            .margin({ left: 15, right: 15, bottom: 10 })
            .onClick(() => {
              if (this.currentTheme.name !== 'light') {
                this.switchTheme('light');
              }
            })

            // æ·±è‰²ä¸»é¢˜é€‰é¡¹
            Row() {
              Text('ğŸŒ™')
                .fontSize(32)
                .margin({ right: 15 })

              Column() {
                Text('æ·±è‰²ä¸»é¢˜')
                  .fontSize(18)
                  .fontWeight(FontWeight.Medium)
                  .fontColor(this.currentTheme.primaryText)
                  .margin({ bottom: 4 })

                Text('å¤©è“è‰²ç³»')
                  .fontSize(14)
                  .fontColor(this.currentTheme.secondaryText)
              }
              .alignItems(HorizontalAlign.Start)
              .layoutWeight(1)

              if (this.currentTheme.name === 'dark') {
                Text('âœ“')
                  .fontSize(24)
                  .fontColor(this.currentTheme.successColor)
                  .fontWeight(FontWeight.Bold)
              }
            }
            .width('100%')
            .padding({ left: 20, right: 20, top: 15, bottom: 15 })
            .backgroundColor(this.currentTheme.cardBg)
            .borderRadius(12)
            .margin({ left: 15, right: 15, bottom: 10 })
            .onClick(() => {
              if (this.currentTheme.name !== 'dark') {
                this.switchTheme('dark');
              }
            })
          }
          .width('100%')
          .margin({ bottom: 20 })

          // é¢„ç•™å…¶ä»–è®¾ç½®åˆ†ç»„çš„ä½ç½®
          // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šè®¾ç½®é¡¹
        }
        .width('100%')
      }
      .layoutWeight(1)
      .width('100%')
      .backgroundColor(this.currentTheme.primaryBg)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(this.currentTheme.primaryBg)
  }
}
